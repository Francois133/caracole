{% extends 'layout.html' %}
{% load floreal_filters %}
{% load static %}

{% block head %}
    <style type="text/css">
    </style>
{% endblock head %}

{% block content %}

<h1>Gestion des commandes des réseaux Caracole</h1>

<p>Bienvenue sur le site web de commande des réseaux Caracole.</p>

{% for nw in networks %}
<h2>Réseau {{nw.network.name}}</h2>
<ul>
  {% for dv in nw.deliveries %}
  <li>Commande {{dv.delivery.name}}:
    {% if dv.delivery.is_archived %}
    archivée
    {% else %}
    <ul>

      {# This will fail if administrators aren't users of their own network #}
      {% if dv.delivery.is_open %}
      {% if dv.order.purchases|length > 0 %}
      <li><a href="{% url 'edit_user_purchases' delivery=dv.order.delivery.id %}">
        modifier la commande</a>:
        <ul>
          {% for p in order.purchases %}
          <li>{{p}}</li>
          {% endfor %}{# purchases #}
        </ul>
      </li>
      {% else %}{# no purchase yet #}
      <li><a href="{% url 'edit_user_purchases' delivery=dv.delivery.id %}">
        Commander
      </a></li>
      {% endif %}{# purchases > 0 #}
      {% endif %}{# is_user_available #}


      {% if nw.is_network_staff %}
      {% if dv.delivery.is_open %}
      <li><em>[admin]</em> <a href="{% url 'set_delivery_state' delivery=dv.delivery.id state='Closed'%}">
          Interdire les commandes
      </a></li>
      {% else %}
      <li><em>[admin]</em> <a href="{% url 'set_delivery_state' delivery=dv.delivery.id state='Open'%}">
          Autoriser les commandes
      </a></li>
      <li><em>[admin]</em> <a href="{% url 'set_delivery_state' delivery=dv.delivery.id state='Delivered'%}">
          Archiver la livraison <img src="{% static 'images/bin.png' %}"/>
      </a></li>
      {% endif %}{# delivery.is_open #}
      <li><em>[admin]</em> <a href="{% url 'edit_delivery_products' delivery=dv.delivery.id %}">
        Modifier les produits disponibles <img src="{% static 'images/edit.png' %}"/>
      </a></li>
      <li><em>[admin]</em> Voir les commandes de tout le réseau {{nw.network.name}}<br/>
        <a href="{% url 'view_delivery_purchases_html' delivery=dv.delivery.id %}">en ligne</a>,
        <a href="{% url 'view_delivery_purchases_xlsx' delivery=dv.delivery.id %}">dans un tableau Excel <img src="{% static 'images/excel.png' %}"/></a>
      </li>
      {% endif %}{# is_network_staff #}


      {% if nw.staffed_subgroup %}
      <li><em>[admin-sous-groupe]</em> Voir les commandes du sous-groupe {{nw.subgroup.name}} pour {{dv.delivery.name}}<br/>
        <a href="{% url 'view_subgroup_purchases_html' delivery=dv.delivery.id %}">en ligne</a>,
        <a href="{% url 'view_subgroup_purchases_pdf' delivery=dv.delivery.id %}">en PDF <img src="{% static 'images/pdf.png' %}"/></a>,
        <a href="{% url 'view_subgroup_purchases_xlsx' delivery=dv.delivery.id %}">dans un tableau Excel <img src="{% static 'images/excel.png' %}"/></a>
      </li>
      <li><em>[admin-sous-groupe]</em> <a href="{% url 'edit_subgroup_purchases' delivery=dv.delivery.id %}">
        Modifier les commandes du sous-groupe {{nw.subgroup.name}} <img src="{% static 'images/edit.png' %}"/>
      </a></li>
      {% if not nw.is_network_staff %}
      <li><em>[admin]</em> <a href="{% url 'emails_subgroup' nw.subgroup.id %}">e-mails du sous-groupe {{nw.subgroup.name}} <img src="{% static 'images/email.png' %}"/></a></li>
      {% endif %}{# subgroup_staff but not network_staff #}
      {% endif %}{# is_subgroup_staff #}


    </ul>
    {% endif %}{# is not archived #}
  </li>
  {% endfor %}{# delivery #}
  {% if nw.is_network_staff %}
  <li><em>[admin]</em> <a href="{% url 'emails_network' network=nw.network.id %}">e-mails du réseau {{nw.network.name}} <img src="{% static 'images/email.png' %}"/></a></li>
  <li><em>[admin]</em> <a href="{% url 'create_delivery' network=nw.network.id %}">Créer une nouvelle commande {{nw.network.name}}</a></li>
  {% endif %}
</ul>
{% endfor %}{# networks #}

{% endblock content %}
